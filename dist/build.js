#! /usr/bin/env node
!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){e.exports=require("tslib")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bufferToStream=t.stringToStream=t.streamToString=void 0;const o=n(4);t.streamToString=function(e,t="utf8"){const n=[];return new Promise((o,r)=>{e.on("error",r).on("data",e=>n.push(e)).on("end",()=>o(Buffer.concat(n).toString(t)))})},t.stringToStream=function(e,t=null){const n=new o.Readable;return n.push(e,t),n.push(null,t),n},t.bufferToStream=function(e){return new o.Readable({read(){this.push(e),this.push(null)}})}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tasks=void 0;const o=n(14),r=n(24),s=n(36),i={"build:css":o.method,"build:js":r.method,"update:csproj":s.method};t.tasks=i},function(e,t){e.exports=require("fancy-log")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runtimeRequire=void 0,t.runtimeRequire=function(e){return require(e)}},function(e,t){e.exports=require("libxmljs")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.result=t.info=t.error=void 0;const o=n(0),r=o.__importDefault(n(6)),s=o.__importDefault(n(41));t.error=function(e,t="",n=""){r.default.error(`${s.default.red("Error")}: ${e} ${s.default.yellow(t)} ${n&&s.default.red("on line "+n)}`)},t.info=function(e,t,n=""){const o=[e,s.default.cyan(t),n];r.default.info(o.join(" "))},t.result=function({name:e,size:t,type:n}){const o=[s.default.grey(" ->"),s.default.yellow(e+n),s.default.grey(t)];r.default.info(o.join(" "))}},function(e,t){e.exports=require("is-glob")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getResultFileName=void 0,t.getResultFileName=function({name:e,type:t,hash:n,prefix:o}){let r=e+(n?"."+n:"")+t;return o&&(r=`${o}-${r}`),r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeFile=void 0;const o=n(0).__importDefault(n(3));t.writeFile=async function(e,t,n="utf8"){const r=o.default.createWriteStream(e,n);return new Promise(async(e,n)=>{t.pipe(r).on("finish",e),r.on("error",n)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),r=n(5),s=o.__importStar(n(9)),i=n(42),a=n(44),u=n(45);process.on("warning",e=>console.warn(e.stack));const c=process.argv[2]||"",l=process.argv[3]||"";r.tasks[c]||(s.error("Unknown build task:",`"${c}"`),process.exit(1));const f=i.loadConfig(c,l),d=new u.TaskRunner(c,f);try{a.validOptions(f)}catch({message:e}){s.error("Invalid arguments:",e),process.exit(1)}d.start(),d.watch()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.method=void 0;const o=n(15);t.method=async function(e){const t=o.bundleCompiler(e);return async({data:e,name:n,path:o})=>{const r=n+".css",{cssValue:s,cssModule:i}=await t(e,o);return{[r]:s,[r+".json"]:i}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bundleCompiler=void 0;const o=n(16),r=n(18),s=n(23);t.bundleCompiler=function(e){const t=o.sassCompiler(e),n=r.cssProcessor(e);return async(e,o)=>new Promise((r,i)=>e.pipe(t(o)).pipe(n(o)).pipe(s.emitFile(r)).on("error",i))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sassCompiler=void 0;const o=n(17),r=n(4);function s(e,t){return function(n){const r=o.renderSync({data:n.toString(),file:e,includePaths:[],sourceMap:t,sourceMapEmbed:t});this.push(r)}}t.sassCompiler=function({sourceMap:e}){return t=>new r.Transform({objectMode:!0,transform:s(t,e)})}},function(e,t){e.exports=require("node-sass")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cssProcessor=void 0;const o=n(0),r=o.__importDefault(n(19)),s=o.__importDefault(n(20)),i=o.__importDefault(n(21)),a=o.__importDefault(n(22)),u=n(4);function c(e,t,n){return async function(o){const r=await e.process(o.css,{from:t,map:n});this.push(r)}}t.cssProcessor=function({release:e,cssModules:t,sourceMap:n}){const o=[s.default({cascade:!1,overrideBrowserslist:["last 2 versions","> 1%"]})];t&&o.unshift(i.default({generateScopedName:e?"[hash:base64:8]":"[name]-[local]"})),e&&o.push(a.default());const l=r.default(o);return e=>new u.Transform({objectMode:!0,transform:c(l,e,n)})}},function(e,t){e.exports=require("postcss")},function(e,t){e.exports=require("autoprefixer")},function(e,t){e.exports=require("postcss-modules")},function(e,t){e.exports=require("cssnano")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emitFile=void 0;const o=n(4),r=n(2);function s(e){const t=e.find(e=>"postcss-modules"===e.plugin),n=null==t?void 0:t.exportTokens;if(n)return r.stringToStream(JSON.stringify(n))}t.emitFile=function(e){return new o.Transform({objectMode:!0,transform:({css:t,messages:n})=>e({cssValue:r.stringToStream(t),cssModule:s(n)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.method=void 0;const o=n(25);t.method=async function(e){const t=o.bundleCompiler(e);return async({data:e,path:n})=>(await t(e,n)).reduce((e,t)=>(e[t.name]=t.data,e),{})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bundleCompiler=void 0;const o=n(0),r=o.__importDefault(n(26)),s=o.__importDefault(n(27)),i=n(28),a=n(2);t.bundleCompiler=function(e){const t=i.webpackCompiler(e);return(e,n)=>new Promise((o,i)=>{const u=[];e.pipe(r.default(n)).pipe(s.default()).pipe(t()).on("data",({basename:e,contents:t})=>{u.push({name:e,data:a.stringToStream(t)})}).on("error",i).on("close",()=>o(u))})}},function(e,t){e.exports=require("vinyl-source-stream")},function(e,t){e.exports=require("vinyl-named")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webpackCompiler=void 0;const o=n(0).__importDefault(n(29)),r=n(30);t.webpackCompiler=function(e){const t=new r.WebpackInstance(e);let n=null;return()=>(n||(n=function(e){return o.default(e.onStreamWrite,(function(){e.onStreamEnd(this)}))}(t)),n.on("end",()=>{n=null}),n)}},function(e,t){e.exports=require("through")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebpackInstance=void 0;const o=n(0),r=o.__importDefault(n(31)),s=o.__importDefault(n(6)),i=o.__importDefault(n(32)),a=o.__importDefault(n(33)),u=o.__importDefault(n(1)),c=n(7),l=n(34);t.WebpackInstance=class{constructor(e){this.options=e,this.fileSystem=new i.default,this.entry={},this.onStreamWrite=({named:e,path:t})=>{this.entry[e]||(this.entry[e]=[]),this.entry[e].push(t)},this.onStreamEnd=e=>{const t=this.getWebpackConfig();this.instance||(this.instance=r.default(t)),this.instance.run(this.onComplete(e)),this.onAfterEmit(e)},this.onComplete=e=>(t,n)=>{t?e.emit("error",t):(s.default.info(n.toString({colors:!0})),e.emit("end"))},this.onTapAsync=(e,{assets:t},n)=>{const o=Object.keys(t);for(const n of o){if(!t[n].emitted)continue;const o=this.prepareFile(n);e.queue(o)}n()}}onAfterEmit(e){const{instance:t,fileSystem:n}=this;t.outputFileSystem=n,t.hooks.afterEmit.tapAsync("WebpackStream",(t,n)=>this.onTapAsync(e,t,n))}getWebpackConfig(){const{options:e,entry:t,config:n}=this;if(n)return n;let o;try{o=c.runtimeRequire("./webpack.config.js")}catch(t){o=l.defaultWebpackConfig(e)}return this.config={...o,entry:t}}prepareFile(e){const{instance:t,fileSystem:n}=this;let o=n.join(t.outputPath,e);-1!==o.indexOf("?")&&(o=o.split("?")[0]);const r=n.readFileSync(o);return new a.default({base:t.outputPath,path:u.default.join(t.outputPath,e),contents:r})}}},function(e,t){e.exports=require("webpack")},function(e,t){e.exports=require("memory-fs")},function(e,t){e.exports=require("vinyl")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultWebpackConfig=void 0;const o=n(0).__importDefault(n(1)),r=n(35);t.defaultWebpackConfig=function({release:e,pathAlias:t,includePath:n}){return{target:"web",mode:e?"production":"development",cache:!e,output:{libraryTarget:"commonjs",filename:"[name].js",chunkFilename:"[name].js",jsonpFunction:"__IDL__",crossOriginLoading:"anonymous"},resolve:{modules:["node_modules",...n?[o.default.resolve(n)]:[]],extensions:[".ts",".tsx",".js",".jsx",".json",".scss",".css"],alias:{...t?{"@":o.default.resolve(t)}:{}}},module:{rules:[{test:/\.tsx?$/,include:n?o.default.resolve(n):void 0,use:[{loader:r.resolveLoader("ts-loader")}]}]},optimization:{mergeDuplicateChunks:!0,runtimeChunk:!1,splitChunks:{name:!0,chunks:"async",cacheGroups:{default:!1,commons:{name:"common",minChunks:2,maxInitialRequests:5},vendor:{test:/[\\/]node_modules[\\/]/,name:"vendor",enforce:!0,chunks:"all"}}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveLoader=void 0;const o=n(0),r=o.__importDefault(n(3)),s=o.__importDefault(n(1));t.resolveLoader=function(e){return r.default.existsSync("node_modules/"+e)?e:s.default.resolve("node_modules/ideal-tools/node_modules",e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.method=void 0;const o=n(37),r=n(38);t.method=async function({manifestPath:e}){const t=await o.loadManifest(e);return async({data:n,name:o})=>({[o+".csproj"]:await r.buildResult(e,t,n)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadManifest=void 0;const o=n(0),r=o.__importDefault(n(3)),s=o.__importDefault(n(1));t.loadManifest=function(e){const t=s.default.resolve(e,"assets.json");return new Promise((e,n)=>{r.default.readFile(t,(t,o)=>{t?n(t):e(JSON.parse(o.toString()))})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildResult=void 0;const o=n(0),r=o.__importDefault(n(1)),s=o.__importDefault(n(8)),i=n(2),a=n(39),u=n(40);t.buildResult=async function(e,t,n){const o=await a.parseXMLDoc(n);return Object.keys(t).forEach(t=>{const n=new s.default.Element(o,u.config.element);n.attr(u.config.attribute,r.default.join(e,t)),o.get(u.config.xpath,{xmlns:u.config.xmlns}).addChild(n)}),i.stringToStream(o.toString())}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseXMLDoc=void 0;const o=n(0).__importDefault(n(8)),r=n(2);t.parseXMLDoc=async function(e){const t=await r.streamToString(e);return o.default.parseXml(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0;t.config={xpath:"/xmlns:Project/xmlns:ItemGroup[xmlns:Content]",xmlns:"http://schemas.microsoft.com/developer/msbuild/2003",element:"Content",attribute:"Include"}},function(e,t){e.exports=require("chalk")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadConfig=void 0;const o=n(0).__importDefault(n(1)),r=n(43),s=n(7),i={sourceDirectory:r.argv.sourceDir||void 0,release:!!r.argv.release,outputPath:r.argv.outputPath||void 0,sourceMap:!!r.argv.sourceMap,cssModules:!!r.argv.cssModules,watch:!!r.argv.watch,watchPath:r.argv.watchPath||void 0,verbose:!!r.argv.verbose,pathAlias:r.argv.pathAlias,filePrefix:r.argv.filePrefix||void 0,includePath:r.argv.includePath||void 0,skipManifest:!!r.argv.skipManifest,manifestPath:r.argv.manifestPath||r.argv.outputPath||void 0};t.loadConfig=function(e,t){t.startsWith("--")&&(t=void 0);try{const{[e]:n={}}=s.runtimeRequire(o.default.resolve("./ideal.config"));return function(e,t){const n=["skipManifest"],o=Object.keys(i).filter(e=>n.indexOf(e)),r={...t,...e?{sourcePath:e}:{}};o.forEach(e=>{const t=i[e];void 0!==t&&(r[e]=t)}),r.manifestPath||(r.manifestPath=r.outputPath);return r}(t,n)}catch(e){return{...i,sourcePath:t}}}},function(e,t){e.exports=require("yargs")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validOptions=void 0;const o=n(0),r=o.__importDefault(n(10)),s=o.__importDefault(n(3));t.validOptions=function({sourcePath:e,outputPath:t,watchPath:n}){if(!r.default(e)&&!s.default.existsSync(e))throw new Error(`Invalid source path: "${e}"`);if(!t||t&&!s.default.existsSync(t))throw new Error(`Missing output path "${t}"`);if(n&&!r.default(n))throw new Error(`Incorrectly formatted "${n}"`);return!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TaskRunner=void 0;const o=n(0),r=o.__importDefault(n(46)),s=o.__importDefault(n(47)),i=o.__importDefault(n(48)),a=o.__importDefault(n(10)),u=o.__importDefault(n(1)),c=n(5),l=o.__importStar(n(9)),f=n(49),d=n(50),p=n(52),m=n(53),h=n(56),_=n(58),y=n(59);t.TaskRunner=class{constructor(e,t){this.methodKey=e,this.options=t}async start(){const{options:e}=this;(await this.readPaths()).length?(await i.default(e.outputPath),await this.setMethod(),await this.taskMethod()):l.error("No matching files for",e.sourcePath)}async watch(){const{sourcePath:e,watch:t,watchPath:n,outputPath:o}=this.options;t&&r.default.watch(n||e,{atomic:!1,ignored:[o]}).on("change",()=>this.taskMethod())}async readPaths(){const{sourceDirectory:e,sourcePath:t}=this.options,n=u.default.join(e||"",t);return this.filePaths=[n],a.default(t)&&(this.filePaths=await d.readGlobFiles(n)),this.filePaths}async setMethod(){const{methodKey:e,options:t}=this;try{const n=await c.tasks[e](t);this.taskMethod=()=>this.runTask(n)}catch({message:e,file:t,line:n}){l.error(e,t,n),process.exit(1)}}async runTask(e){const{options:t,filePaths:n,taskRunning:o}=this;if(o)return;this.taskRunning=!0,this.logRunTime("start");const r=n.map(e=>f.readFile(e)).map((t,o)=>e({data:t,path:n[o],name:p.getStreamFileName(t)}));let s=[];try{s=await this.processTasks(r)}catch({message:e,file:t,line:n}){l.error(e,t,n),process.exit(1)}t.verbose&&s.forEach(l.result),this.taskRunning=!1,this.logRunTime("end")}logRunTime(e){const{methodKey:t}=this,n=(new Date).getTime();if("start"===e)return this.startTime=n,void l.info("Running",t,"task...");const o=s.default((new Date).getTime()-this.startTime);l.info("Finished",t,"after "+o)}async processTasks(e){const{release:t,outputPath:n,filePrefix:o,skipManifest:r,manifestPath:s}=this.options;let i=[];return i=await m.processStreams(e,o),i=await h.hashFileNames(i,t),i=await _.writeStreams(i,n),r||(i=await y.writeManifest(i,s)),i}}},function(e,t){e.exports=require("chokidar")},function(e,t){e.exports=require("pretty-ms")},function(e,t){e.exports=require("mkdirp")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readFile=void 0;const o=n(3);t.readFile=function(e,t=null){return o.createReadStream(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readGlobFiles=void 0;const o=n(0).__importDefault(n(51));t.readGlobFiles=e=>new Promise((t,n)=>o.default(e,async(e,o)=>{e?n(e):t(o)}))},function(e,t){e.exports=require("glob")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStreamFileNames=t.getStreamFileName=void 0;const o=n(0).__importDefault(n(1));function r({path:e}){const{name:t}=o.default.parse(e);return t}t.getStreamFileNames=function(e){return e.map(r)},t.getStreamFileName=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processStreams=void 0;const o=n(0),r=o.__importDefault(n(54)),s=o.__importDefault(n(1)),i=n(55);t.processStreams=async function(e,t){return function(e,t){const n=e.map(e=>Object.keys(e)).map((n,o)=>n.map(n=>function(e,t,n){const o=s.default.parse(t),i=e[t];return{name:o.name,type:o.ext,hash:"",prefix:n,size:i&&r.default(i.readableLength),stream:i}}(e[o],n,t)));return i.flattenArray(n).filter((e,t,n)=>n.findIndex(({name:t,type:n})=>t===e.name&&n===e.type)===t).filter(({stream:e})=>!!e)}(await Promise.all(e),t)}},function(e,t){e.exports=require("filesize")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flattenArray=void 0,t.flattenArray=function(e){return[].concat.apply([],e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hashFileNames=void 0;const o=n(0),r=n(2),s=o.__importDefault(n(57));t.hashFileNames=async function(e,t){if(!t)return e;const{contents:n,streams:o}=await async function(e){const t=await Promise.all(e.map(e=>r.streamToString(e))),n=t.map(e=>r.stringToStream(e));return{contents:t,streams:n}}(e.map(({stream:e})=>e)),i=n.map(e=>s.default(e,{algorithm:"md5"}).substr(0,8));return e.map((e,t)=>({...e,stream:o[t],hash:i[t]}))}},function(e,t){e.exports=require("hasha")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeStreams=void 0;const o=n(0).__importDefault(n(1)),r=n(11),s=n(12);t.writeStreams=async function(e,t){return await Promise.all(e.map(e=>s.writeFile(o.default.join(t,r.getResultFileName(e)),e.stream))),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeManifest=void 0;const o=n(0),r=o.__importDefault(n(3)),s=o.__importDefault(n(1)),i=n(11),a=n(2),u=n(12);t.writeManifest=async function(e,t){const n=s.default.join(t,"assets.json"),o=await c(n),r=e.reduce((e,t)=>(e[t.name+t.type]=i.getResultFileName(t),e),{}),l=a.stringToStream(JSON.stringify({...o,...r}));return await u.writeFile(n,l),e};const c=e=>new Promise((t,n)=>r.default.readFile(e,(e,n)=>{let o={};if(!e&&n){try{o=JSON.parse(n.toString())}catch(e){}t(o)}else t({})}))}]);